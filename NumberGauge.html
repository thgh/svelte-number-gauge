<script>
  export let value = 0
  export let arrows = ''

  let rotate
  let degrees
  let light
  let hue

  $: rotate = (100 - value) * 1.8
  $: light = 60 - Math.max(value - 20, 0) / 5
  $: hue = Math.max(value * 1.5 - 30, 0)

  $: degrees = arrows
    ? String(arrows)
        .split(',')
        .map(a => parseInt(a) * 1.8)
        .filter(a => a > -1)
    : []
</script>

<div class="chart">
  {#each degrees as degree}
  <div class="abs" style="transform:rotate({degree}deg)">
    <div class="max"></div>
  </div>
  {/each}
  <div class="overflow">
    <div class="fill bg"></div>
    <div
      class="fill"
      style="transform:rotate(-{rotate}deg);background: hsl({hue},100%,{light}%);"
    ></div>
    <div class="white"></div>
    <div class="value">{value}</div>
  </div>
</div>

<style>
  .chart {
    position: relative;
    width: 4em;
    height: 2em;
    box-sizing: border-box;
  }
  .fill {
    position: absolute;
    z-index: 2;
    background: red;
    width: 100%;
    height: 100%;
    border-radius: 2em 2em 0 0;
    transition: transform 0.2s;
    transform-origin: 50% 100%;
  }
  .bg {
    z-index: 1;
    background: #ccc;
  }
  .max {
    position: absolute;
    z-index: 2;
    left: -6px;
    top: -6px;
    width: 6px;
    height: 0;
    border-top: 6px solid transparent;
    border-bottom: 6px solid transparent;
    border-left: 6px solid #000;
  }
  .overflow {
    position: absolute;
    width: 100%;
    height: 100%;
    overflow: hidden;
  }
  .abs {
    position: absolute;
    z-index: 0;
    background: red;
    width: 100%;
    height: 0;
    border-radius: 2em 2em 0 0;
    transition: transform 0.2s;
    left: 0%;
    top: 100%;
  }
  .value {
    position: absolute;
    z-index: 4;
    bottom: 0;
    left: 0;
    right: 0;
    text-align: center;
    font-weight: bold;
    line-height: 1em;
  }
  .white {
    position: absolute;
    z-index: 3;
    top: 20%;
    left: 10%;
    width: 80%;
    height: 160%;
    border-radius: 100%;
    background: white;
  }
</style>
